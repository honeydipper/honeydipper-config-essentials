---
contexts:
  _default:
    start_kube_job:
      predefined_env:
        gcloud_config:
          name: CLOUDSDK_CONFIG
          value: /honeydipper/.config/gcloud

      predefined_steps:
        google_auth:
          type: gcloud
          name: google-auth
          shell: gcloud auth activate --key-file=/etc/gcloud/service-account.json
          volumes:
            - mountPath: /etc/gcloud/service-account.json
              subPath: service-account.json
              volume:
                - name: gcloud_service_credentials
                  secret:
                    defaultMode: 420
                    secretName: $?ctx.google_credentials_secret
                    items:
                      - key: '{{ default "service-account.json" .ctx.google_credentials_secret_key }}'
                        path: service-account.json

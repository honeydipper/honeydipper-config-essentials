---
systems:
  jira:
    data:
      API_KEY: _place_holder_
      token: _place_holder_
      path: "/jira"
      jira_domain: _place_holder_
      jira_credentials: _place_holder_

    functions:
      createTicket:
        driver: web
        rawAction: request
        parameters:
          method: POST
          URL: https://{{ .sysData.jira_domain }}.atlassian.net/rest/api/2/issue/
          header:
            Authorization: Basic {{ .sysData.jira_credentials }}
            Accept: application/json
            Content-Type: application/json
          content:
            fields:
              project:
                key: $ctx.jira_project
              summary: $ctx.ticket_title
              description: $ctx.ticket_desc
              issuetype:
                name: '{{ .ctx.ticket_type | default "Task" }}'
          export:
            jira_ticket: $data.json.key

      addComment:
        driver: web
        rawAction: request
        parameters:
          method: POST
          URL: https://{{ .sysData.jira_domain }}.atlassian.net/rest/api/2/issue/{{ .ctx.jira_ticket }}/comment
          header:
            Authorization: Basic {{ .sysData.jira_credentials }}
            Accept: application/json
            Content-Type: application/json
          content:
            body: $ctx.comment_body

    triggers:
      hit:
        driver: webhook
        if_match:
          method: POST
          form:
            token: $sysData.token
          url: $sysData.path
